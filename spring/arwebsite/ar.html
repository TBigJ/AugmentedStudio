<!DOCTYPE html>
<html>
	<head>



    <!-- include a-frame -->
    <script src="https://mnutsch.github.io/arjs_workshop/start/vendor/aframe/build/aframe.min.js"></script>

    <!-- include ar.js for aframe -->
    <script src='https://mnutsch.github.io/arjs_workshop/start/vendor/arjs/build/aframe-ar.js'></script>
    <script>ARjs.Context.baseURL = 'https://mnutsch.github.io/arjs_workshop/start/vendor/three.js/'</script>
    <!-- Note: the above libraries are included with absolute URL's, because Github.io seems to prefer those. Change them to relative URL's -->

    <script>
			var txtFile = decodeURIComponent(window.location.search);
			txtFile = txtFile.substring(1);

			var rawFile = new XMLHttpRequest();
			rawFile.open("GET", txtFile, false);
			var allText = rawFile.responseText;
			console.log("testtest\n\n\n"+allText);


      //wait until the page loads to perform the following
      window.onload = function ()
      {

        var intervalLength = 20; //determines the speed of the animation (milliseconds to wait between ticks)


        //define the scene, for ease of interacting with it
        var scene = document.querySelector('a-scene');
				const blackset = new Set([1,3,6,8,10]);
        //ADD JAVASCRIPT CODE HERE...

        //Timer for animations
                var set1 = new Set([84, 72]);
                var set2 = new Set([72, 86]);
                var set3 = new Set([86, 75]);
                var input_list = [set1,set2,set3];
				var cur_input = new Set([84, 72]);
				var req_input = new Set([85,84]);
				console.log(req_input);

				var Time = 100;

				var order = 0;

				find_dist = function (req_input) {

					var temp = req_input - 59;
					var distance = Math.floor(temp/12) * 7;
					temp = temp % 12;

					if (temp <= 5){
						distance += (temp + 1) / 2;
					}
					else {
						distance += (temp + 2) / 2;
					}

				    return (distance - 15);

				}

				check_correct = function (req_input, cur_input){
					if (!req_input.has(cur_input)){
						 <!-- draws the x on the wrong input -->
						 <!--wrong_point.-->

						 wrong_point.setAttribute('position', find_dist(cur_input) + " " + 0 + " "  + .1);
						 wrong_point.setAttribute('color','red');
						 wrong_point.setAttribute('opacity', 100);
					}
				}

				var position = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];



				var i = 0;
        //setInterval(function()
        {
            cur_input = input_list[i];
            req_input = input_list[i+1];
					// add the ones that are not used back to empty set
					// get difference of pressed set - required input

					const set_difference = ((...sets) => sets.reduce(
                        ((A, B) => {
                            let X = new Set(A);
                            B.forEach( v => {if ( X.has(v) ) X.delete(v)});
                            return X;
                        })
                    ));
					var need_to_release = set_difference(cur_input,req_input);

					for (var it = need_to_release.values(), val= null; val=it.next().value; ){
						var releasing = "playpoint" + (position.indexOf(val)+1);
						var pp = document.getElementById(releasing);

						pp.setAttribute('opacity',0);
						pp.setAttribute('position',0 + " " + 0 + " " + 0);
						position[position.indexOf(val)] = 0;

					}
					// recycle the unused ones

          //ADD CODE HERE TO DO THINGS...



                    var need_to_press = set_difference(req_input, cur_input);
					for (var it = need_to_press.values(), val= null; val=it.next().value; ){


                        var p = position.indexOf(0);
                        position[p] = val;
												console.log("test\n\n\n\n"+position[0],position[1],position[2]);

                        var pstr = "playpoint" + (p+1);
                        var playpoint = document.getElementById(pstr);
                        console.log("testtest\n\n"+pstr);
                        if ((blackset.has((val - 60)%12)) && (val > 0)) {

                            playpoint.setAttribute('color','green');
                            playpoint.setAttribute('position',find_dist(val) + " " + 0 + " " + .9);
                            playpoint.setAttribute('radius',.15);
                            playpoint.setAttribute('opacity',100);
                        }
                        else if (!(blackset.has((val-60)%12)) && val > 0)  {
                            playpoint.setAttribute('color','yellow');
                            playpoint.setAttribute('position', find_dist(val) + " " + 0 + " " + 4);
                            playpoint.setAttribute('radius',.3);
                            playpoint.setAttribute('opacity',100);
                        }
                        else {
                            playpoint.setAttribute('opacity',0);
                            playpoint.setAttribute('position', 0 + " " + 0 + " " + 0);

                        }




					}

						check_correct(req_input, cur_input);



        }//, intervalLength);

      }
    </script>

  </head>

  <!-- start the body of your page -->
  <body style='margin : 0px; overflow: hidden;'>
    <!-- add some info at the top of the page -->
    <div style='position: fixed; top: 10px; width:100%; text-align: center; z-index: 1; color: white;'>
      Instructions:<br/>
      Point your camera at the target marker.
    </div>

    <!-- Define your 3d scene and enabled ar.js -->
    <a-scene debug embedded arjs='trackingMethod: best; debugUIEnabled: false;'>

      <!-- Declare assets for use in the scene. -->
      <a-assets timeout="1000">
        <!-- Declare assets here. These are things like images or 3D models. -->

        <!-- Example of how to declare a 3D model asset. -->
        <!--<a-asset-item id="3DModel-obj" src="3Dmodel.obj"></a-asset-item preload="auto">-->
        <!-- Example of how to declare a skin for a 3D model asset. -->
        <!--<a-asset-item id="3DModel-mtl" src="3DModel.mtl"></a-asset-item>-->

      </a-assets>

      <!-- Create a anchor to attach your augmented reality -->
      <a-anchor hit-testing-enabled='true'>

        <!-- Add your augmented reality items here -->

        <!-- example of basic text in 3D -->
        <!-- see: https://github.com/aframevr/aframe/blob/master/docs/components/text.md -->
        <!--<a-entity id="basicText" position='0 0 0' scale='1 1 1' color='red' text='value: Hello World;'></a-entity>-->

        <!-- example of a basic plane. -->
        <!-- see: https://aframe.io/docs/0.8.0 -->
        <!--<a-plane color="blue" height="1" width="1" rotation="-90 0 0"></a-plane>-->

        <!-- example of text fit onto a plane -->
        <!--
        <a-plane
        id = "helloWorldPlane"
        geometry="primitive: plane; width: 1; height: 1; height: auto"
        material="opacity: 0.5; color: white;"
        position='0 0.25 3'>
          <a-entity id="planeText" scale='2 2 2' text="value: Hello World;" align-"center"></a-entity>
        </a-plane>
        -->

        <!-- Basic Box -->
        <!-- see: https://aframe.io/docs/0.8.0 -->
        <!-- <a-box id="myBoxtop" rotation="0 0 0" position='0 0 .5' depth=".01" height="1.5" width="31" material='opacity: 0.5; side:double; color:cyan;'></a-box>
				<a-box id="myBoxbottom" rotation="0 0 0" position='0 0  4' depth=".01" height="1.5" width="31" material='opacity: 0.5; side:double; color:cyan;'></a-box>

				<a-box id="myBoxleft" rotation="0 90 0" position='-14.5 0  2.5' depth=".01" height="1.5" width="3.8" material='opacity: 0.5; side:double; color:cyan;'></a-box>
				<a-box id="myBoxright" rotation="0 90 0" position='14.5 0  2.5' depth=".01" height="1.5`" width="3.8" material='opacity: 0.5; side:double; color:cyan;'></a-box>
 -->

				<!-- <a-box id="scale84" rotation="0 90 0" position='0 0  2.5' depth=".01" height="1" width="3.8" material='opacity: 0.5; side:double; color:cyan;'></a-box> -->
				<a-sphere id="playpoint1" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint2" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint3" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint4" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint5" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint6" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint7" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint8" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint9" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>
				<a-sphere id="playpoint10" position='0 0 0' poscolor="yellow" radius="0.3"></a-sphere>


				<a-sphere id="wrong_point" position='0 0 0' opacity = "0" poscolor="white" radius="0.3"></a-sphere>


				<!-- key steps -->

				<!-- Basic Sphere -->
        <!-- see: https://aframe.io/docs/0.8.0/primitives/a-sphere.html -->
        <!--<a-sphere id="mySphere" position='0 0 0' color="yellow" radius="0.05"></a-sphere>-->

        <!-- 3D Model example -->
        <!-- see: https://aframe.io/docs/0.8.0/primitives/a-obj-model.html -->
        <!--<a-obj-model id="my3DModel" src="#3DModel-obj" position="0 0 0" rotation="0 0 0" scale=".1 .1 .1" material="opacity: 0.9; side:double; color: orange;"></a-obj-model>-->
        <!-- 3D Model example with skin -->
        <!--<a-obj-model id="my3DModel" src="#3DModel-obj" mtl="#3DModel-mtl" position="0 0 0" rotation="0 0 0" scale="1 1 1" material="opacity: 1.0; side:double;"></a-obj-model>-->

      </a-anchor>

      <!-- Define a static camera -->
      <a-camera position="0 -2 0" zoom = 2></a-camera>

    </a-scene>

    <!-- add some info at the bottom left of the page -->
    <div >
      <span id="myText" style='z-index: 1; color: white; position: fixed; left: 50px; bottom: 10px;'>Add some text here.</span>
    </div>

  </body>

</html>
